version: '3.8'

services:
  # Redis service
  redis:
    image: redis:7
    container_name: sendmail_db
    ports:
      - "6379:6379"
    command: ["redis-server", "--requirepass", "mypassword"]
    volumes:
      - ./redis_data:/data

  # Main microservice
  sendemail_service:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: mrs_sendemail_service
    ports:
      - "8200:8200"
    environment:
      # Server config
      SERVER_PORT: 8200
      SERVER_HOST: 0.0.0.0
      
      # Redis config
      REDIS_HOST: redis
      REDIS_PORT: 6379
      REDIS_PASSWORD: mypassword
      REDIS_DB: 0
      
      # Gmail SMTP config (cần thay đổi)
      SMTP_HOST: smtp.gmail.com
      SMTP_PORT: 587
      SMTP_USERNAME: your-email@gmail.com
      SMTP_PASSWORD: your-app-password
      SMTP_FROM_NAME: Fix4Home System
      
      # API Security (cần thay đổi)
      API_KEYS: fix4home_key_123,partner_key_456,admin_key_789
      
      # Rate limiting
      RATE_LIMIT_EMAIL_PER_HOUR: 5
      RATE_LIMIT_IP_PER_HOUR: 30
      
      # Code config
      CODE_EXPIRE_MINUTES: 30
      CODE_LENGTH: 6
      DEFAULT_SYSTEM_NAME: Fix4Home
    depends_on:
      - redis
    volumes:
      # Mount .env file nếu có
      - ./.env:/root/.env:ro 